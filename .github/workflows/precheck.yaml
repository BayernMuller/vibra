name: Precheck

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  workflow_dispatch:

jobs:
  precheck:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential \
            cmake \
            cpplint \
            clang-tidy \
            clang-format \
            libcurl4-openssl-dev \
            libfftw3-dev

      - name: Check cpplint
        run: cpplint $(git ls-files '*.cpp' '*.h')

      - name: Check clang-tidy
        run: |
          cmake -B build -DCMAKE_EXPORT_COMPILE_COMMANDS=ON .
          clang-tidy -p build/compile_commands.json $(git ls-files '*.cpp' '*.h' | grep -v 'wasm.cpp')

      # TODO(BayernMuller): Add clang-format check
      # - name: Check clang-format
      #   run: |
      #     clang-format --dry-run --Werror $(git ls-files '*.cpp' '*.h')

